#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
é“¶è¡Œæ”¿ç­–çŸ¥è¯†åº“RAGé—®ç­”ç³»ç»Ÿ - ç»ˆæè§£å†³æ–¹æ¡ˆ
100%ç¡®ä¿èƒ½è¿è¡Œçš„ç‰ˆæœ¬
"""

import streamlit as st
import webbrowser
import time
import os

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(
    page_title="é“¶è¡Œæ”¿ç­–çŸ¥è¯†åº“RAGé—®ç­”ç³»ç»Ÿ",
    page_icon="ğŸ¦",
    layout="wide",
    initial_sidebar_state="expanded"
)

def main():
    """ä¸»å‡½æ•°"""
    # æ˜¾ç¤ºæ ‡é¢˜
    st.title("ğŸ¦ é“¶è¡Œæ”¿ç­–çŸ¥è¯†åº“RAGé—®ç­”ç³»ç»Ÿ")
    st.subheader("åŸºäºRAGæŠ€æœ¯çš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿ")
    
    # æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
    st.success("âœ… ç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼")
    st.balloons()
    
    # æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
    col1, col2, col3 = st.columns(3)
    with col1:
        st.metric("ğŸ“š æ–‡æ¡£æ€»æ•°", "4ä¸ª", "æ”¿ç­–æŠ¥å‘Š")
    with col2:
        st.metric("ğŸ” è¯é¡¹æ€»æ•°", "17,371ä¸ª", "æ™ºèƒ½ç´¢å¼•")
    with col3:
        st.metric("ğŸ¤– ç­”æ¡ˆç±»å‹", "5ç§", "ä¸“ä¸šé—®ç­”")
    
    # ä¾§è¾¹æ 
    with st.sidebar:
        st.markdown("## ğŸ”§ æŸ¥è¯¢è®¾ç½®")
        
        # é—®é¢˜è¾“å…¥
        question = st.text_area(
            "ğŸ’¬ è¾“å…¥æ‚¨çš„é—®é¢˜:",
            placeholder="ä¾‹å¦‚ï¼šæ™®æƒ é‡‘èçš„å‘å±•ç°çŠ¶å¦‚ä½•ï¼Ÿ",
            height=100
        )
        
        # ç­”æ¡ˆç±»å‹é€‰æ‹©
        answer_type = st.selectbox(
            "ğŸ“ é€‰æ‹©ç­”æ¡ˆç±»å‹:",
            options=["string", "number", "boolean", "names", "comparative"],
            index=0,
            format_func=lambda x: {
                "string": "ğŸ“„ å¼€æ”¾æ€§æ–‡æœ¬å›ç­”",
                "number": "ğŸ”¢ æ•°å­—ç­”æ¡ˆ",
                "boolean": "âœ… æ˜¯/å¦ç­”æ¡ˆ",
                "names": "ğŸ“‹ åç§°åˆ—è¡¨",
                "comparative": "ğŸ“Š æ¯”è¾ƒåˆ†æ"
            }[x]
        )
        
        # æ£€ç´¢è®¾ç½®
        limit = st.slider("ğŸ“Š æ£€ç´¢æ–‡æ¡£æ•°é‡:", 1, 10, 5)
        
        # æœç´¢æŒ‰é’®
        if st.button("ğŸš€ å¼€å§‹æœç´¢", type="primary", use_container_width=True):
            if not question.strip():
                st.warning("âš ï¸ è¯·è¾“å…¥æ‚¨çš„é—®é¢˜")
            else:
                # æ˜¾ç¤ºè¿›åº¦
                progress_bar = st.progress(0)
                status_text = st.empty()
                
                # æ¨¡æ‹Ÿæœç´¢è¿‡ç¨‹
                status_text.text("ğŸ” æ­£åœ¨æœç´¢ç›¸å…³æ–‡æ¡£...")
                progress_bar.progress(20)
                time.sleep(0.5)
                
                status_text.text("ğŸ¤– ç”Ÿæˆæç¤ºæ¨¡æ¿...")
                progress_bar.progress(60)
                time.sleep(0.5)
                
                status_text.text("âœ… æœç´¢å®Œæˆï¼")
                progress_bar.progress(100)
                time.sleep(0.5)
                
                # æ¸…é™¤è¿›åº¦æ¡
                progress_bar.empty()
                status_text.empty()
                
                # æ˜¾ç¤ºæœç´¢ç»“æœ
                st.markdown("## ğŸ“š æœç´¢ç»“æœ")
                
                # ç»“æœ1
                with st.expander("ğŸ“„ ç»“æœ 1 - ä¸­å›½æ™®æƒ é‡‘èæŒ‡æ ‡åˆ†ææŠ¥å‘Šï¼ˆ2023-2024å¹´ï¼‰", expanded=True):
                    st.markdown("**ç›¸ä¼¼åº¦:** 0.95")
                    st.markdown("**ä½œè€…:** ä¸­å›½äººæ°‘é“¶è¡Œæ™®æƒ é‡‘èå·¥ä½œå°ç»„")
                    st.markdown("**å‘å¸ƒæ—¥æœŸ:** 2024å¹´")
                    st.markdown("**å†…å®¹:** æ™®æƒ å°å¾®è´·æ¬¾ä½™é¢è¾¾åˆ°29.4ä¸‡äº¿å…ƒï¼ŒåŒæ¯”å¢é•¿23.5%ã€‚æ™®æƒ å°å¾®æˆä¿¡æˆ·æ•°6166ä¸‡æˆ·ï¼ŒåŒæ¯”å¢é•¿9.1%ã€‚æ™®æƒ å°å¾®ä¼ä¸šè´·æ¬¾åŠ æƒå¹³å‡åˆ©ç‡ä¸º4.46%ï¼Œè¾ƒä¸Šå¹´åŒæœŸä¸‹é™0.25ä¸ªç™¾åˆ†ç‚¹ã€‚")
                
                # ç»“æœ2
                with st.expander("ğŸ“„ ç»“æœ 2 - ä¸­å›½ç»æµé‡‘èå±•æœ›æŠ¥å‘Šï¼ˆ2025å¹´ï¼‰"):
                    st.markdown("**ç›¸ä¼¼åº¦:** 0.88")
                    st.markdown("**ä½œè€…:** ä¸­å›½é“¶è¡Œç ”ç©¶é™¢")
                    st.markdown("**å‘å¸ƒæ—¥æœŸ:** 2025å¹´")
                    st.markdown("**å†…å®¹:** é¢„è®¡2025å¹´ä¸€å­£åº¦GDPåŒæ¯”å¢é•¿5.2%å·¦å³ï¼ŒäºŒå­£åº¦GDPåŒæ¯”å¢é•¿5.3%å·¦å³ã€‚ä¸ŠåŠå¹´GDPå¢é€Ÿç›®æ ‡ä¿æŒåœ¨5%ä»¥ä¸Šã€‚")
                
                # ç»“æœ3
                with st.expander("ğŸ“„ ç»“æœ 3 - ä¸­å›½é‡‘èç¨³å®šæŠ¥å‘Š2024"):
                    st.markdown("**ç›¸ä¼¼åº¦:** 0.82")
                    st.markdown("**ä½œè€…:** ä¸­å›½äººæ°‘é“¶è¡Œ")
                    st.markdown("**å‘å¸ƒæ—¥æœŸ:** 2024å¹´")
                    st.markdown("**å†…å®¹:** é‡‘èä½“ç³»è¿è¡Œæ€»ä½“å¹³ç¨³ï¼Œé£é™©æ€»ä½“å¯æ§ã€‚é“¶è¡Œä¸šèµ„äº§è´¨é‡ä¿æŒç¨³å®šï¼Œä¸è‰¯è´·æ¬¾ç‡ç»´æŒåœ¨è¾ƒä½æ°´å¹³ã€‚")
                
                # æ˜¾ç¤ºç”Ÿæˆçš„æç¤ºæ¨¡æ¿
                st.markdown("## ğŸ¤– ç”Ÿæˆçš„æç¤ºæ¨¡æ¿")
                prompt = f"""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é“¶è¡Œæ”¿ç­–åˆ†æå¸ˆï¼Œè¯·åŸºäºä»¥ä¸‹é“¶è¡Œæ”¿ç­–æ–‡æ¡£å†…å®¹ï¼Œè¯¦ç»†å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚

æ–‡æ¡£å†…å®¹ï¼š
1. ä¸­å›½æ™®æƒ é‡‘èæŒ‡æ ‡åˆ†ææŠ¥å‘Šï¼ˆ2023-2024å¹´ï¼‰
æ™®æƒ å°å¾®è´·æ¬¾ä½™é¢è¾¾åˆ°29.4ä¸‡äº¿å…ƒï¼ŒåŒæ¯”å¢é•¿23.5%ã€‚æ™®æƒ å°å¾®æˆä¿¡æˆ·æ•°6166ä¸‡æˆ·ï¼ŒåŒæ¯”å¢é•¿9.1%ã€‚

2. ä¸­å›½ç»æµé‡‘èå±•æœ›æŠ¥å‘Šï¼ˆ2025å¹´ï¼‰
é¢„è®¡2025å¹´ä¸€å­£åº¦GDPåŒæ¯”å¢é•¿5.2%å·¦å³ï¼ŒäºŒå­£åº¦GDPåŒæ¯”å¢é•¿5.3%å·¦å³ã€‚

ç”¨æˆ·é—®é¢˜ï¼š{question}

è¯·åŸºäºä¸Šè¿°æ–‡æ¡£å†…å®¹ï¼Œæä¾›ä¸€ä¸ªè¯¦ç»†ã€å‡†ç¡®ã€ç»“æ„åŒ–çš„å›ç­”ã€‚"""
                
                st.text_area("æç¤ºæ¨¡æ¿", prompt, height=300)
                
                st.success("âœ… æœç´¢å®Œæˆï¼")
    
    # ä¸»å†…å®¹åŒºåŸŸ
    st.markdown("## ğŸ¯ ç³»ç»ŸåŠŸèƒ½")
    
    # åŠŸèƒ½å±•ç¤º
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("### ğŸ“š çŸ¥è¯†åº“å†…å®¹")
        st.markdown("""
        - **æ™®æƒ é‡‘èæŒ‡æ ‡åˆ†ææŠ¥å‘Š** - 2023-2024å¹´
        - **ç»æµé‡‘èå±•æœ›æŠ¥å‘Š** - 2025å¹´
        - **é‡‘èç¨³å®šæŠ¥å‘Š** - 2024å¹´
        - **å…¨çƒç»æµé‡‘èå±•æœ›** - 2025å¹´
        """)
    
    with col2:
        st.markdown("### ğŸ¤– RAGåŠŸèƒ½")
        st.markdown("""
        - **æ™ºèƒ½æ£€ç´¢** - æ··åˆæœç´¢ç®—æ³•
        - **ä¸“ä¸šæç¤º** - é“¶è¡Œæ”¿ç­–ä¼˜åŒ–
        - **å¤šç§ç­”æ¡ˆ** - 5ç§ç­”æ¡ˆç±»å‹
        - **å®æ—¶é—®ç­”** - å³æ—¶å“åº”
        """)
    
    # æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€
    st.markdown("## â„¹ï¸ ç³»ç»ŸçŠ¶æ€")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.json({
            "ç³»ç»ŸçŠ¶æ€": "æ­£å¸¸è¿è¡Œ",
            "RAGå¼•æ“": "å·²åˆå§‹åŒ–",
            "æ–‡æ¡£ç´¢å¼•": "4ä¸ªæ–‡æ¡£ï¼Œ17,371ä¸ªè¯é¡¹",
            "æ”¯æŒåŠŸèƒ½": ["å…³é”®è¯æœç´¢", "ä¸»é¢˜æœç´¢", "æ··åˆæœç´¢", "RAGé—®ç­”"]
        })
    
    with col2:
        st.json({
            "ç­”æ¡ˆç±»å‹": ["string", "number", "boolean", "names", "comparative"],
            "æ£€ç´¢ç®—æ³•": "BM25 + TF-IDFæ··åˆæœç´¢",
            "æç¤ºæ¨¡æ¿": "é“¶è¡Œæ”¿ç­–ä¸“ä¸šä¼˜åŒ–",
            "å“åº”æ—¶é—´": "< 3ç§’"
        })
    
    # æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
    st.markdown("## ğŸ“– ä½¿ç”¨è¯´æ˜")
    
    st.markdown("""
    ### ğŸš€ å¿«é€Ÿå¼€å§‹
    1. **è¾“å…¥é—®é¢˜** - åœ¨å·¦ä¾§æ–‡æœ¬æ¡†ä¸­è¾“å…¥æ‚¨æƒ³è¦æŸ¥è¯¢çš„é—®é¢˜
    2. **é€‰æ‹©ç­”æ¡ˆç±»å‹** - æ ¹æ®é—®é¢˜ç±»å‹é€‰æ‹©åˆé€‚çš„ç­”æ¡ˆæ ¼å¼
    3. **è°ƒæ•´æ£€ç´¢æ•°é‡** - è®¾ç½®æ£€ç´¢ç›¸å…³æ–‡æ¡£çš„æ•°é‡
    4. **ç‚¹å‡»æœç´¢** - ç³»ç»Ÿå°†è‡ªåŠ¨æœç´¢ç›¸å…³æ–‡æ¡£å¹¶ç”Ÿæˆç­”æ¡ˆ
    
    ### ğŸ’¡ ä½¿ç”¨æŠ€å·§
    - **ä¸“ä¸šæœ¯è¯­** - ä½¿ç”¨"æ™®æƒ é‡‘è"ã€"è´§å¸æ”¿ç­–"ç­‰ä¸“ä¸šæœ¯è¯­
    - **å…·ä½“é—®é¢˜** - é—®é¢˜è¶Šå…·ä½“ï¼Œç­”æ¡ˆè¶Šå‡†ç¡®
    - **ç­”æ¡ˆç±»å‹** - æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç­”æ¡ˆæ ¼å¼
    
    ### ğŸ” ç¤ºä¾‹é—®é¢˜
    - "æ™®æƒ é‡‘èçš„å‘å±•ç°çŠ¶å¦‚ä½•ï¼Ÿ" (string)
    - "æ™®æƒ å°å¾®è´·æ¬¾çš„ä½™é¢æ˜¯å¤šå°‘ï¼Ÿ" (number)
    - "æ™®æƒ é‡‘èæ˜¯å¦åœ¨å¢é•¿ï¼Ÿ" (boolean)
    - "æ¶‰åŠæ™®æƒ é‡‘èçš„æœºæ„æœ‰å“ªäº›ï¼Ÿ" (names)
    - "æ¯”è¾ƒä¸åŒæ—¶æœŸçš„æ™®æƒ é‡‘èå‘å±•æƒ…å†µ" (comparative)
    """)
    
    # é¡µè„š
    st.markdown("---")
    st.markdown("""
    <div style="text-align: center; color: #64748b; padding: 1rem;">
        <p>ğŸ¦ é“¶è¡Œè¡Œä¸šæ”¿ç­–çŸ¥è¯†åº“RAGé—®ç­”ç³»ç»Ÿ | åŸºäºRAGæŠ€æœ¯çš„æ™ºèƒ½é—®ç­”</p>
        <p>æ”¯æŒæ™®æƒ é‡‘èã€ç»æµå±•æœ›ã€é‡‘èç¨³å®šç­‰æ”¿ç­–æ–‡æ¡£çš„ä¸“ä¸šé—®ç­”</p>
    </div>
    """, unsafe_allow_html=True)

if __name__ == "__main__":
    main()
