# 银行行业政策知识库混合搜索使用说明

## 概述
混合搜索功能结合了BM25和TF-IDF两种经典的信息检索算法，为知识库提供更准确、更全面的搜索体验。

## 算法原理

### BM25算法
- **特点**: 基于概率模型的经典排序算法
- **优势**: 考虑文档长度归一化，适合精确匹配
- **权重**: 0.6 (在混合搜索中)

### TF-IDF算法
- **特点**: 基于词频-逆文档频率的向量空间模型
- **优势**: 能够捕捉语义相似性
- **权重**: 0.4 (在混合搜索中)

### 混合策略
- 将两种算法的分数进行归一化
- 按权重组合：`混合分数 = 0.6 × BM25分数 + 0.4 × TF-IDF分数`
- 提供更平衡的搜索结果

## 使用方法

### 1. 启动混合搜索演示
```bash
cd knowledge_base
python search/hybrid_interface.py
```

### 2. 程序化使用
```python
from search_engine import KnowledgeBaseSearchEngine

# 初始化搜索引擎
search_engine = KnowledgeBaseSearchEngine(".")

# 混合搜索
results = search_engine.hybrid_search("普惠金融", limit=5)

# 主题混合搜索
topic_results = search_engine.search_by_topic_hybrid("普惠金融", limit=3)

# 关键词混合搜索
keyword_results = search_engine.search_by_keyword_hybrid("小微企业", limit=3)
```

## 搜索功能

### 1. 通用混合搜索
- **方法**: `hybrid_search(query, limit=10, bm25_weight=0.6, tfidf_weight=0.4)`
- **参数**:
  - `query`: 搜索查询
  - `limit`: 返回结果数量
  - `bm25_weight`: BM25权重 (默认0.6)
  - `tfidf_weight`: TF-IDF权重 (默认0.4)

### 2. 主题混合搜索
- **方法**: `search_by_topic_hybrid(topic, limit=10)`
- **特点**: 自动提取主题相关关键词进行搜索

### 3. 关键词混合搜索
- **方法**: `search_by_keyword_hybrid(keyword, limit=10)`
- **特点**: 专门针对关键词的混合搜索

## 搜索结果格式

```python
{
    "type": "hybrid_search",
    "query": "搜索查询",
    "document_id": "文档ID",
    "title": "文档标题",
    "author": "作者",
    "publish_date": "发布日期",
    "hybrid_score": 1.0000,      # 混合分数
    "bm25_score": 1.2004,        # BM25分数
    "tfidf_score": 0.0004,       # TF-IDF分数
    "context": [...],            # 相关上下文
    "summary": "文档摘要",
    "keywords": ["关键词1", "关键词2"]
}
```

## 性能特点

### 优势
1. **准确性**: 结合两种算法的优势，提供更准确的搜索结果
2. **平衡性**: 既考虑精确匹配，也考虑语义相似
3. **可调性**: 可以调整BM25和TF-IDF的权重
4. **上下文**: 自动提取相关段落，提供更好的用户体验

### 适用场景
- 精确关键词搜索
- 语义相似性搜索
- 主题相关文档发现
- 学术研究和政策分析

## 示例搜索

### 热门搜索词
- 普惠金融
- 小微企业
- 金融稳定
- 货币政策
- 风险监管

### 主题搜索
- 普惠金融
- 经济展望
- 金融稳定
- 政策法规

## 技术细节

### 索引构建
- 自动分词处理
- 词频统计
- 文档频率计算
- 平均文档长度计算

### 分数计算
- BM25: 考虑词频、文档频率、文档长度
- TF-IDF: 考虑词频和逆文档频率
- 归一化: 避免不同算法分数范围差异

### 上下文提取
- 自动识别相关段落
- 计算相关性分数
- 提供上下文信息

## 注意事项

1. **首次运行**: 需要构建索引，可能需要一些时间
2. **内存使用**: 索引会占用一定内存空间
3. **文件编码**: 确保文本文件使用UTF-8编码
4. **路径配置**: 确保文档路径配置正确

## 故障排除

### 常见问题
1. **索引构建失败**: 检查文档路径和文件编码
2. **搜索结果为空**: 检查查询词是否在文档中存在
3. **性能问题**: 考虑减少返回结果数量

### 调试方法
- 查看日志输出
- 检查索引文件完整性
- 验证文档内容可读性 